# Healthcare Voice Agent — POC

A voice-driven healthcare admin assistant for appointment scheduling.

## Architecture

```
Browser (React)
  │  mic audio (WebM)
  ▼
FastAPI  ─── Step 2: OpenAI Whisper STT ──► text
  │
  ├── Step 3: Claude (Haiku) Intent Detection
  │             ↓
  ├── Step 4: LangGraph Agent Router
  │             ↓
  ├── Step 5: Appointment Agent (LangGraph ReAct + Claude Opus)
  │             ↓
  ├── Step 6: Tools
  │            ├── Excel (patients.xlsx)  ← patient lookup
  │            └── Google Calendar / in-memory demo  ← appointments
  │
  ├── Step 7: Response generated by Claude
  ├── Step 8: OpenAI TTS → MP3
  └── Step 9: Goal confirmation + response closure
         │
         ▼
Browser plays audio + shows transcript
```

## Quick Start

### 1. Backend

```bash
cd backend

# Copy and fill in your API keys
cp .env.example .env

# Install dependencies (Python 3.11+)
pip install -r requirements.txt

# Create sample patient Excel data
python data/create_sample_data.py

# Start the API server
uvicorn main:app --reload --port 8000
```

Required environment variables in `.env`:
| Variable | Required | Description |
|---|---|---|
| `ANTHROPIC_API_KEY` | Yes | Claude API key |
| `OPENAI_API_KEY` | Yes | Whisper STT + TTS |
| `GOOGLE_SERVICE_ACCOUNT_FILE` | No | Path to Google service account JSON |
| `GOOGLE_CALENDAR_ID` | No | Calendar ID (leave blank for in-memory demo) |

### 2. Frontend

```bash
cd frontend
npm install
npm run dev
```

Open http://localhost:5173

### 3. (Optional) Google Calendar Setup

1. Create a project at [Google Cloud Console](https://console.cloud.google.com)
2. Enable the **Google Calendar API**
3. Create a **Service Account** and download the JSON key
4. Share your Google Calendar with the service account email
5. Set `GOOGLE_SERVICE_ACCOUNT_FILE` and `GOOGLE_CALENDAR_ID` in `.env`

Without these, the system runs with an **in-memory demo calendar** pre-seeded with sample appointments.

## Sample Voice Commands

| Say | Intent |
|---|---|
| "Book an appointment for Alice Johnson with Dr. Smith tomorrow at 2 PM for a checkup" | schedule_appointment |
| "What appointments do we have tomorrow?" | check_appointments |
| "Cancel appointment APT001" | cancel_appointment |
| "Reschedule Bob Williams' appointment to Friday at 10 AM" | reschedule_appointment |
| "Find patient Alice Johnson" | patient_lookup |
| "What slots are available with Dr. Smith on Monday?" | check_appointments |

## API Endpoints

| Method | Path | Description |
|---|---|---|
| `POST` | `/api/process-audio` | Full voice pipeline (multipart audio) |
| `POST` | `/api/process-text` | Text-in/text-out (for testing) |
| `GET` | `/api/health` | Health check |
| `GET` | `/api/session/{id}` | Get conversation history |
| `DELETE` | `/api/session/{id}` | Clear session |

## Project Structure

```
healthcare-voice-agent/
├── backend/
│   ├── main.py               # FastAPI app
│   ├── config.py             # Settings
│   ├── stt.py                # OpenAI Whisper STT
│   ├── tts.py                # OpenAI TTS
│   ├── agent_router.py       # LangGraph orchestration pipeline
│   ├── agents/
│   │   └── appointment_agent.py  # ReAct agent with 6 tools
│   ├── tools/
│   │   ├── excel_tools.py    # Patient data (Excel)
│   │   └── calendar_tools.py # Appointments (Google Cal / in-memory)
│   ├── models/
│   │   └── schemas.py        # Pydantic models
│   └── data/
│       └── create_sample_data.py
└── frontend/
    └── src/
        ├── App.tsx
        ├── components/
        │   ├── VoiceButton.tsx    # Hold-to-record button
        │   ├── ConversationLog.tsx
        │   └── StatusBadge.tsx
        └── services/
            └── agentApi.ts
```
